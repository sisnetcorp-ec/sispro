<?php
/* CbPlus */
/*

*/
 class ZimbraHttpStreamWrapper { const PROTOCOL = "\172\151\155\x62\162\141\x68\x74\164\160\163\164\162\145\x61\x6d"; private $zimbrahttpstream; private $position; private $zimbrahttpstreamlength; public function stream_open($path, $mode, $options, &$opened_path) { try { goto vrdfdf4YQfIz; kD60OBMCa1HE: $context = stream_context_create($opts); goto ipLejcqt3NtT; s9qIylB8E5_R: if ($id) { goto bf9hXDVLckNE; } goto ogu3BaEfycEj; CicJpFZw7adU: $opts = array("\x68\x74\x74\x70" => array("\x6d\x65\x74\150\157\x64" => "\107\x45\x54", "\150\145\141\x64\145\162" => "\x43\157\x6e\164\x65\156\x74\55\x74\171\160\x65\72\x20\x61\x70\x70\x6c\151\143\141\x74\x69\x6f\x6e\57\x78\55\167\x77\x77\55\146\157\162\155\x2d\165\x72\154\x65\x6e\x63\x6f\144\x65\x64" . "\15\xa" . "\x43\x6f\157\x6b\x69\145\x3a\40" . "\132\115\137\101\x55\124\x48\137\124\117\x4b\105\116\x3d" . $authToken . "\xd\xa"), "\x73\x73\154" => array("\x76\x65\x72\151\146\171\137\x70\145\145\x72" => $sslVerifyPeer, "\x76\145\162\151\x66\x79\137\160\x65\145\162\137\156\141\155\x65" => !(0 == $sslVerifyPeerName))); goto kD60OBMCa1HE; ogu3BaEfycEj: return null; goto xNEDewUUajJA; szfspdKkWoJN: if (!($part != '')) { goto bG25aHMxF2Wo; } goto hf3SQ_HrupKn; o_DitEvfFgEI: $authToken = $contextOptions[self::PROTOCOL]["\x61\x75\x74\x68\124\157\153\x65\156"]; goto ErH6_BkFvPVZ; jDmNu97oIsTJ: $this->zimbrahttpstreamlength = $contextOptions[self::PROTOCOL]["\x6c\145\156\x67\x74\150"]; goto ogGlT3elCsEF; EGrwHLgRbHZD: $this->position = 0; goto s9qIylB8E5_R; KHDSjxGwJDFF: $part = $contextOptions[self::PROTOCOL]["\160\x61\x72\x74"]; goto SuF5Bl7WXH3q; xNEDewUUajJA: bf9hXDVLckNE: goto XbwaJQf4u3wf; ipLejcqt3NtT: $this->zimbrahttpstream = fopen($url, "\x72\x62", false, $context); goto jDmNu97oIsTJ; hf3SQ_HrupKn: $url = $url . "\x26\x70\x61\162\164\x3d" . $part; goto WUe_W7ipWFJy; XbwaJQf4u3wf: $url = $publicUrl . "\57\163\x65\x72\x76\151\x63\145\x2f\143\157\x6e\x74\x65\x6e\x74\57\x67\x65\164\x3f\x69\144\x3d" . $id; goto szfspdKkWoJN; oMtlYtXdkeU3: Ec0lj2PrEJW6: goto rs7FV0tEIaxH; SBeqOda0Gr0M: $sslVerifyPeerName = $contextOptions[self::PROTOCOL]["\163\x73\154\126\145\x72\151\x66\171\x50\145\x65\162\x4e\141\x6d\x65"]; goto EGrwHLgRbHZD; ogGlT3elCsEF: ZLog::Write(LOGLEVEL_DEBUG, sprintf("\x5a\151\x6d\x62\162\141\x48\164\164\x70\123\164\162\x65\x61\155\127\162\x61\x70\x70\x65\x72\x2d\76\x73\x74\x72\x65\141\x6d\x5f\x6f\x70\x65\156\x28\51\72\40\151\x6e\151\x74\151\x61\x6c\151\x7a\145\x64\x20\163\164\x72\145\x61\155\x20\x6c\145\156\x67\164\150\x3a\x20\x25\144", $this->zimbrahttpstreamlength)); goto D0lMR3Qt378S; vrdfdf4YQfIz: $contextOptions = stream_context_get_options($this->context); goto SWDoNgLnjhxo; D0lMR3Qt378S: return true; goto Z_zx4hytAfTI; SuF5Bl7WXH3q: $sslVerifyPeer = $contextOptions[self::PROTOCOL]["\163\x73\154\x56\145\x72\x69\x66\171\x50\x65\145\162"]; goto SBeqOda0Gr0M; EiLDgYww3R1P: return false; goto oMtlYtXdkeU3; SWDoNgLnjhxo: if (!(!isset($contextOptions[self::PROTOCOL]["\160\165\x62\154\x69\143\x55\x72\154"]) || !isset($contextOptions[self::PROTOCOL]["\141\x75\x74\x68\124\157\153\x65\x6e"]) || !isset($contextOptions[self::PROTOCOL]["\151\144"]) || !isset($contextOptions[self::PROTOCOL]["\x70\x61\x72\164"]) || !isset($contextOptions[self::PROTOCOL]["\154\x65\x6e\147\x74\x68"]))) { goto Ec0lj2PrEJW6; } goto EiLDgYww3R1P; ErH6_BkFvPVZ: $id = $contextOptions[self::PROTOCOL]["\x69\144"]; goto KHDSjxGwJDFF; WUe_W7ipWFJy: bG25aHMxF2Wo: goto CicJpFZw7adU; rs7FV0tEIaxH: $publicUrl = $contextOptions[self::PROTOCOL]["\x70\165\142\x6c\x69\x63\x55\x72\154"]; goto o_DitEvfFgEI; Z_zx4hytAfTI: } catch (\Exception $e) { goto P6WZeGoQJpUC; P6WZeGoQJpUC: if (!($options & STREAM_REPORT_ERRORS)) { goto vNY60J1jJrnY; } goto DjnIVphLuxgp; lYWNkd_misUb: vNY60J1jJrnY: goto GaIavVxVGnOd; DjnIVphLuxgp: trigger_error($e->getMessage(), E_USER_WARNING); goto lYWNkd_misUb; GaIavVxVGnOd: return false; goto gCJewQybF1kj; gCJewQybF1kj: } } public function stream_read($len) { goto vfypNGF6nhBY; vfypNGF6nhBY: $data = fread($this->zimbrahttpstream, $len); goto MQtQWIUQilXf; qeHvPNySfYtq: return $data; goto uGt3XcIRgtGZ; MQtQWIUQilXf: $this->position += strlen($data); goto qeHvPNySfYtq; uGt3XcIRgtGZ: } public function stream_write($data) { return 0; } public function stream_seek($offset, $whence = SEEK_SET) { goto fxGFmWrrlmXl; XTpsVFfBMlyb: BqY2cktGyhBN: goto PMjq4T0LGN1q; PMjq4T0LGN1q: $this->position = $this->zimbrahttpstreamlength + $offset; goto ysPzuoMheDP5; OCmn0v04Jekh: sBl3aDWQ62MF: goto Hs1iOxNdGzk3; IhEPuQW6zZy5: $this->position = $offset; goto aptjxN7JVN8v; ysPzuoMheDP5: ZZr4u5Fs4Q8q: goto yJkzcBbecS7T; wZvw1O10oAma: return fseek($this->zimbrahttpstream, $offset, $whence); goto u0z7cYYkUlch; yJkzcBbecS7T: goto Z6wzcAiy30Zi; goto OCmn0v04Jekh; aptjxN7JVN8v: goto ZZr4u5Fs4Q8q; goto XTpsVFfBMlyb; ya2Efp0tRS1o: if ($whence == SEEK_END) { goto BqY2cktGyhBN; } goto IhEPuQW6zZy5; gfZG37ypPn8H: Z6wzcAiy30Zi: goto wZvw1O10oAma; fxGFmWrrlmXl: if ($whence == SEEK_CUR) { goto sBl3aDWQ62MF; } goto ya2Efp0tRS1o; Hs1iOxNdGzk3: $this->position += $offset; goto gfZG37ypPn8H; u0z7cYYkUlch: } public function stream_tell() { return $this->position; } public function stream_eof() { return $this->position >= $this->zimbrahttpstreamlength; } public function stream_stat() { ZLog::Write(LOGLEVEL_DEBUG, sprintf("\x5a\x69\x6d\142\x72\141\x48\x74\164\x70\x53\164\162\x65\141\155\127\162\141\x70\160\x65\162\55\76\x73\164\162\x65\x61\x6d\137\x73\164\141\x74\x28\51\x3a\40\x53\x74\x61\x74\x3a\x20\45\x64", $this->zimbrahttpstreamlength)); return array(7 => $this->zimbrahttpstreamlength, "\x73\151\172\145" => $this->zimbrahttpstreamlength); } public static function Open($authToken, $publicUrl, $id, $part, $length, $sslVerifyPeer = 0, $sslVerifyPeerName = 0) { goto IaYAB1mL2UZn; bwnJRYU0Z0Z9: $context = stream_context_create($opts); goto dTsDzyUXnHyl; dTsDzyUXnHyl: return fopen(self::PROTOCOL . "\x3a\57\x2f", "\162\x62", false, $context); goto ahUOSYQ7yLef; IaYAB1mL2UZn: $opts = array(self::PROTOCOL => array("\160\165\142\154\x69\x63\125\162\x6c" => $publicUrl, "\x61\x75\164\x68\x54\157\153\145\x6e" => $authToken, "\x69\144" => $id, "\x70\x61\x72\x74" => $part, "\x6c\145\x6e\147\x74\x68" => $length, "\163\x73\154\x56\145\x72\151\146\171\x50\x65\x65\162" => $sslVerifyPeer, "\163\x73\154\126\x65\162\x69\x66\171\x50\145\145\162\116\x61\x6d\x65" => $sslVerifyPeerName)); goto bwnJRYU0Z0Z9; ahUOSYQ7yLef: } } stream_wrapper_register(ZimbraHttpStreamWrapper::PROTOCOL, "\132\x69\x6d\142\162\x61\x48\x74\x74\x70\x53\x74\x72\145\x61\x6d\x57\162\141\160\x70\145\x72");
